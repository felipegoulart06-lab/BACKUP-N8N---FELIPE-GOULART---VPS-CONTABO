{
  "active": true,
  "connections": {
    "Webhook - Receber Mensagem": {
      "main": [
        [
          {
            "node": "Set - Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set - Dados": {
      "main": [
        [
          {
            "node": "If - Enviar para IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If - Enviar para IA": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "code tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-29T23:38:33.155Z",
  "id": "7viq8lVXhjCK3zD0",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Atendimento WhatsApp IA – ActiveBackground",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chatwoot-whatsapp",
        "options": {}
      },
      "id": "ae9112fd-56d8-4af3-b314-24fb05e1625e",
      "name": "Webhook - Receber Mensagem",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -144,
        0
      ],
      "typeVersion": 2.1,
      "webhookId": "577bd90d-dac4-494d-96dd-16e0fa3e8802"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6502303a-7120-4d64-ae9a-9ea7ea6b60a2",
              "name": "body.conversation.meta.sender.phone_number",
              "value": "={{ $json.body.conversation.meta.sender.phone_number }}",
              "type": "string"
            },
            {
              "id": "bbffe22b-b2ea-4cc6-a733-bd29a4c642c7",
              "name": "body.conversation.meta.sender.identifier",
              "value": "={{ $json.body.conversation.meta.sender.identifier }}",
              "type": "string"
            },
            {
              "id": "983ecce1-7782-4226-b2ab-5d1a3db85105",
              "name": "body.message_type",
              "value": "={{ $json.body.message_type }}",
              "type": "string"
            },
            {
              "id": "1116e14f-0f41-4be9-b4ec-cd3b767be19e",
              "name": "body.content",
              "value": "={{ $json.body.content }}",
              "type": "string"
            },
            {
              "id": "f4446653-5665-427d-9f49-4e9247f7e4dd",
              "name": "body.inbox",
              "value": "={{ $json.body.inbox }}",
              "type": "object"
            },
            {
              "id": "d4e5ec7a-af13-46fc-a8a6-e47748ddf572",
              "name": "body.conversation.messages[0].sender.available_name",
              "value": "={{ $json.body.conversation.messages[0].sender.available_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bcd3d516-4638-4609-9b42-de2e2de565cf",
      "name": "Set - Dados",
      "type": "n8n-nodes-base.set",
      "position": [
        96,
        0
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ae806359-8bc7-45d5-b574-ebfd7d818130",
              "leftValue": "={{ $json.body.message_type }}",
              "rightValue": "=outgoing",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c64289a2-25fc-43c0-ad8f-ffd25ec5f384",
      "name": "If - Enviar para IA",
      "type": "n8n-nodes-base.if",
      "position": [
        336,
        0
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "11ce7d1c-78ce-451f-b0ed-51ad164a28e2",
              "leftValue": "={{ $('Webhook - Receber Mensagem').item.json.body.source_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        528,
        -128
      ],
      "id": "651e85a1-a461-4fd4-a2b5-515390788837",
      "name": "Filter"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.content }}",
        "options": {
          "systemMessage": "Você é Felipe Goulart, especialista em desenvolvimento de websites (Front-end e Back-end), automações e criação de imagens, e atua na Active Background.\n\n**Seu Estilo e Personalidade:**\n1. Fale de forma natural, inteligente, experiente e leve.\n2. Use linguagem próxima, com personalidade (pode usar gírias ou expressões de bate-papo).\n3. Vá direto ao ponto. Explique o necessário, sem enrolação.\n4. Seja confiante, tranquilo e mostre interesse prático no problema do usuário.\n5. JAMais diga que é uma IA ou um robô. Você é o Felipe, um parceiro de trabalho.\n\n**Seu Foco Principal:**\nAjudar com criação/desenvolvimento de sites, automações (n8n, bots, integrações) e design/criação de imagens.\n\n---\n\n**INSTRUÇÃO CRUCIAL PARA FERRAMENTAS (TOOLS):**\n\n1. **InfoServicos:**\n   Quando o usuário pedir informações sobre os serviços da Active Background — como *sites, automações, imagens ou sistemas* — **VOCÊ DEVE** utilizar a ferramenta `InfoServicos`.\n   Ela retorna descrições detalhadas sobre o serviço solicitado (ex: \"sites\").\n   **Sempre chame essa ferramenta antes de responder** quando o usuário quiser saber *o que você faz*, *sobre seus serviços* ou *como pode ajudar*.\n\nATENÇÃO: SEMPRE QUE ENVIAR MENSAGEM, ENVIA NO COMEÇO DA MENSAGEM:\n*ActiveBackground - Felipe*"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        560,
        64
      ],
      "id": "83bea48c-c466-4513-b8ca-7bf5e679b08f",
      "name": "AI Agent",
      "notesInFlow": false,
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        512,
        256
      ],
      "id": "287babbe-0474-42b1-a0f1-6df17abd6386",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "aUqWG9Hu0gNKqn8b",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "INSTANCIA ACTIVEBACKGROUND",
        "remoteJid": "={{ $('If - Enviar para IA').item.json.body.conversation.meta.sender.phone_number }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1104,
        64
      ],
      "id": "c0777438-398f-428a-bfd9-5fbae3749465",
      "name": "Enviar texto",
      "credentials": {
        "evolutionApi": {
          "id": "OMumhTKAtpAeMqgF",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('If - Enviar para IA').item.json.body.conversation.meta.sender.phone_number }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        624,
        320
      ],
      "id": "6b3b8823-2244-4226-bbb7-9c94df2c8236",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "3dk8RUr6B35tLvfC",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "description": "Retorna informações detalhadas sobre os serviços oferecidos pelo especialista na Active Background (sites, automações, sistemas, imagens).",
        "jsCode": "def InfoServicos(topico: str) -> str:\n    \"\"\"\n    Retorna informações detalhadas sobre os serviços oferecidos pelo especialista na Active Background (sites, automações, sistemas, imagens).\n    \n    Argumentos:\n        topico (str): O ÚNICO serviço sobre o qual o usuário quer saber mais. Use uma das palavras-chave exatas: 'sites', 'automações', 'sistemas' ou 'imagens'.\n        \n    Retorna:\n        str: Uma descrição detalhada do serviço ou uma mensagem de fallback.\n    \"\"\"\n    \n    servicos = {\n        \"sites\": \"Criação de websites modernos, responsivos, com design personalizado, integrações e SEO. Se o seu projeto precisa de uma presença digital forte, é por aqui!\",\n        \"automações\": \"Desenvolvimento de automações com n8n, APIs, bots e integrações entre plataformas. O foco é fazer seu negócio rodar no automático, economizando tempo e dinheiro.\",\n        \"imagens\": \"Criação de logos, mockups, banners e imagens profissionais usando IA e design digital. Damos aquele tapa visual que o seu material precisa.\",\n        \"sistemas\": \"Criação de sistemas completos, ERPs, painéis administrativos e plataformas web sob medida. Desenvolvemos a ferramenta exata que você precisa, do zero.\"\n    }\n\n    if not topico:\n        return \"Nenhum tópico de serviço foi fornecido. Qual serviço você gostaria de detalhar? (sites, automações, sistemas, imagens).\"\n\n    # Lógica de busca case-insensitive e parcial (se o Agente enviar 'Sobre automação')\n    topico_lower = topico.lower()\n    \n    chave_encontrada = None\n    for chave in servicos.keys():\n        if chave in topico_lower:\n            chave_encontrada = chave\n            break\n\n    if chave_encontrada:\n        # Retorna a string com a descrição do serviço\n        return servicos[chave_encontrada]\n    else:\n        # Resposta de fallback clara\n        return \"Posso te ajudar com desenvolvimento de sites, automações, sistemas e criação de imagens. Sobre qual desses você quer que eu detalhe para você, parceiro?\"\n\n# Para a execução direta em algumas plataformas, a função principal é chamada.\n# Se estiver no n8n ou similar, você deve definir esta função e o Agente de IA \n# a chamará automaticamente.\n# Exemplo de chamada (se necessário):\n# print(InfoServicos(input.get('topico', '')))"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        768,
        320
      ],
      "id": "15e605e3-0c9d-40a1-9c0e-073d76a9a37d",
      "name": "code tool",
      "notesInFlow": false
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-10-29T23:38:33.155Z",
      "createdAt": "2025-10-29T23:38:33.155Z",
      "role": "workflow:owner",
      "workflowId": "7viq8lVXhjCK3zD0",
      "projectId": "Zl3u1vsJTIYoa3dk"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-10-30T21:31:43.488Z",
  "versionId": "574a28d2-a2e1-41ef-a8ba-140e110eedb6"
}